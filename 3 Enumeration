# Enumeration

Goal: Gather more detailed info on both devices and resources attached to the network. For example: account anmes, shares, misconfigured services, etc.

Like the scanning phase, this phase involves active connections to remote devices in the network. 


Examples of protocols that can be exploited if admins dont take steps to secure of disable them. 

## NETBIOS (Network Basic Input Output System) is the service that allows Windows systems to share files, folders, and printers amoung machines on a LAN. 
 If not config'd it can leak a lot of info, such as shares, system info, user IDs, more.  
 
 - [NetBIOS history and info](https://github.com/Kahvi-0/General-Notes/blob/master/Networking/NetBIOS.md)
 
 nbtstat -n can show the NetBIOS names on our machine. 
 
 The service that maps NetBIOS names to IP is WINS (Windows Internal Name Service). 
 
 **NetBIOS Datagram Services ** permits the sending of datagram messages to and from a NetBIOS name and broadcast the datagram to all NetBIOS names. The datagram and broadcast methods allow one computer to comm with several other computers at the same time, however are limited in message size. No error detection/ correction using datagram or broadcast methods, however datagram comm allows comm without need for a session to be est. 
 
  **Net BIOS Session Service (NBSS)** Allows two names to est a connection in order to exchange data. For example, when a device creates a file sharing connection the session service is used. Once the session has been est, the two workstation use the SMB. 
  
    Steps are used to est the connection: 
    
     1. The NetBIOS name is resolved to an IP
     2. A TCP connection is est between two devices using port 139
     3. The initiating device sends a NetBIOS session req over the TCP conn.
       a. This includes the NetBIOS name of the app that wants to est the conn and the NetBIOS name to which to connect
     4. If the remote device is listening on that name, there will be a positive response and the session will be est. 
 
## SMB 

 Known as a response-request protocol  meaning that it transmits multiple messages between the client and server to establish a connection. Clients connect to servers using TCP/IP (actually NetBIOS over TCP/IP as specified in RFC1001 and RFC1002), NetBEUI or IPX/SPX. 
 
 Used to work with NetBIOS. Allows you share files, disks, directories, printers and, in some cases. COM ports across a network. Before Win 2000, SMB ran only with NetBIOS over TCP/IP (port 139), therefore NetBIOS session was required. 
 
 Win 2000 and up allow SMB to run SMB directly over [TCP (direct hosting)](https://support.microsoft.com/en-us/help/204279/direct-hosting-of-smb-over-tcp-ip) without the need of NetBIOS sessions. Thus TCP port 445 was used. 


## NetBIOS commands and tools
 
 Search for systems with ports 137, 139, and 445. 

Enumeration - services: 

 **nbtstat (Windows)** tool dev to troubleshoot NetBIOS name resolution problems. Main options: 
 
 <img width="1416" alt="Capture" src="https://user-images.githubusercontent.com/46513413/86081701-f39e7c00-ba63-11ea-892c-33d86bf0178b.PNG">

 Scenario: You scan a target with port 139 and 137 open. Use nbtstat -A <IP> 
   This will show the remote machines table shows its NetBIOS services. Like below: 
   
 <img width="786" alt="Capture" src="https://user-images.githubusercontent.com/46513413/86081976-b8e91380-ba64-11ea-9c7f-44fc94a2b50a.PNG">

 From here you can see the Hostname is ELS-WINXP and the workgroup is WORKGROUP. Then the last two bytes (HEX) will be the server service, so for the case of <20>, this host has file and printer shares enables, which we may be able to access. [Full list](http://techgenix.com/netbiosservicecodesinthenetbiossuffix/)
 
 Uses NBNS.
 
**nbtscan (Linux)** nbtscan -v <IP or cider>
 Uses NBNS.
 Same results to nbtstat.
 
 step 2:
 
 **net (windows)** command. Net command offers features such as the ability to update user accounts to shared resources and more. 
 
 net view <IP> command can list domains, computers and resources shared by a machine in the network. 
 
 To explore the resources use the  net use command. net use K: \\<IP>\C
   Note: the K: is where we are mapping it to our machine.
 
 **[smbclient (linux)](https://github.com/Kahvi-0/Vulnerabilities-and-Exploitations/blob/master/Network/SMB%20and%20Samba.md)**
 
 smbclient also displays hidden shares. Hidden shares have a $ at the end. 
 
 **null sessions** Can be exploited to est a conn to a target in order to gather info such as shares, users, groups, reg keys and more. 
  Relies on CIFS (Common Interne File System) and SMB that return info even to an unauth user. 
 
## SNMP (Simple Network Management Protocol) used to gather info and config devies (printers, switches, servers, etc). 

Attacks: 

 - Flooding, causing a DoS by spoofing an SNMP agent and flooding the SNMP trap management with thousands of SNMP traps, varying from 50 bytes to 32K until the SNMP mgmt is unablew to function. 

 - Community strings to gain priv access to systems
 
 - Brute force: Using a tool to guess the community strings used on a system to achieve elevated priv





















