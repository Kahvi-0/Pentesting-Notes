# Information gathering 

##Find owner, IP addr, and emails

WHOIS http://whois.domaintools.com/

DNS
it with the discovered IPs or the IPs we are given to test
This will help us gather all IPs related to a domain or sub domain.

   nslookup -querytype=ANY <domain, sub-domain, or IP>

Finding targets ISP

Sometimes target may rely on ISP and hosting companies as they may not be the owners of their IP addresses.

 note: When the org is big, Net-blocks may be assigned to it , so no hosting services are involved. 
 A corp is not limited to having only one hosting company. 

http://whois.arin.net/rest/net/NET-108-162-192-0-1/pft
http://whois.domaintools.com/
https://apps.db.ripe.net/search/query.html


Contains a lot of the elements into one: http://www.netcraft.com/



## Infrastructure

Web server fingerprinting 

  HTTP response headers
  netcraft can reveal info on this sometimes
  netcat
    nc <IP> 80
    The response headers should be inspected
    
  httprint
  
  whatweb
  
    reconizes website tech, web server versions, blog platforms, JS libraries, and more
    whatweb -v <domain>
    
  wappalyzer
  
  

Fingerprint webserver modules 

  Note: url rewriting is taking parameters like  id=100 and the webserver will use a regex rule to match the rewrite rule to translate the ID to a webpage then pass it on.
  done with .htaccess in atache with mod_rewrite and IIS uses Ionic Isap rewrite or Helicon isapi rewrite

  Not having the real URL and only the rewritten URL can make it much more difficuly for a pen test to attack the URLs, however still possible by using other channels such as forms, cookies, and headers.
  
  ugly URLS= /test?id=1100
  searchengine friendly = /test/login.php
  
  Note: input from forms are still intact for you to tamper with
  
  hard to RE rewritting rules
  
  
## Enumerate subdomains

[netcraft](http://searchdns.netcraft.com/):  subdomain matches   <domain>

Google: 

  site:.<domain>
   
  as you discover domain remove them from results with -
   
  site:.<domain>.ca -site:www.<domain>.ca
  
  site:.<domain>.ca -inurl:www.
  
Tools: 

  Subdomain bruteforcing. Queries the domain and does not rely on search engines (good for internal).
  
    subbrute <domain> -s <wordlsit>
  
  Querying search engines
  
    dnsrecon: it can use wordlists to enumerate subdomains but can also leaverage searchengines like google. 

    dnsrecon -d <domain>
  
    The harvester: gathers subdomain names from different public resources search engines or PGP key servers. Also gatheres data from sites such as Linkedin, People123, Twitter, Google+ and more
    
     harvester -d <domain> -b <data source, all > -f <output xml or html>
  
     
Zone transfer

 If allowed will give us way more (or all) info related tothe domain/subdomains. 


## Virtual hosts

A website that shares an IP address with one or more other virtual hosts. Common in shared hosting environments where a multitude of websites share the same server/IP.

For example *admin.foo.com* and *www.foo.com* share 192.168.3.2, so those are virtual hosts. 


## Fingerprinting frameworks and apps

COTS - Common off the shelf 

Common apps like: 

  fourms - phpBB, vBulletin
  CMS - Joomla, Drupal 
  CRM - Blogging platform (wordpress or moveable types)
  social networking script and other apps 
  http://www.hotscripts.com/
  
  
  Sometimes the http response has these listed. A lot of the time it is required for the site to have the version and software at the footer of the page.



Joomla: URL has 3 parts:  index.php?option=%component_name%&task=&task_value&

   - index.php is the only script you will find on Joomla. In charge of loading components via the option parameter. More tasks and arguments are passed to that component with subsequent parameters. 
   

## Fingerprint custom apps

This is built inhouse for the target company. 
Consider the scope of the app while walking through it: 

   - what is it for?
     - What does it do?
     - Sell stuff? 
     - blog ?
     - Corp online presence?
   
   - Does it allow user registration?
   
   - Does it have an admin panel?
   
   - Does it take input from user?
     - What kind of input?
   
   - Does it accept file uploads?
   
   - Does it use JS, Ajax, Flash, etc? 
   
   - What is the core/main area of the site ? 
      - blogs?
      - eCommerce area? 
  
   divide and conquer. For each smaller part of the app, add notes and keep track using a map. 
    - Client side logic (JS)
    
    - flash apps
    
    - cookies and where they are applied
    
    - authorization
    
    - forms, etc

## Mapping the attack surface of a custom app


Create a block map of webpages, their function, what runs on each, etc

1. Client side validation: knowing where user data is validated is important.

  Inspecting the web page sourcecode is one way to reveal client side validation. 
  
  Firebug firefox addon.

2. Database interaction: Detecting the use of DB. Does user input change the appearance of the page bec either diff data is fetched from the DB or is new data added.
 This can lead to SQL injections. 

3. File upload and download: 

4. Display of user supplied data: User input that gets reflected.

5. Redirections: server or client side directives to auto forward the visitor of a web page to another web page. 301 or 302. Pay attention in the proxy where the redirect takes you and the URL. Another kind is the meta refresh, uses meta HTML tags, which are used to add metadata info to a web page. Usually read by search engines to better index the web page. Meta redirect is a way to generate a redirect either after x seconds or immediatly if x=0. 

   <meta http-equiv="Refresh" content="0;
   url=http://example.com/">

 6. Access controls and Login Protected pages: reveal restricted access areas of the site. Will want to try attacks against auth and access control bypass.
 
 7. Error messages: Collect errors as we may come across them. Intentional triggering of errors will come later.
 
 8. Keep track of each of these in each "block" of the mapped website.
 
 # Enumerating resources
 
 
 subdomains, website srtucture, hidden files, config files and any additional leaked info. 
 
 look for backup files. Query for all found files but with the extension .bak, _bak, 01, bac, old, 000, ~, 001, .inc, Xxx
 
 Auth errors give away usernames?
 
 # Relevant info through misconfigs
 
 Looks for open directory listings.
 
 Logs and config files: for example Joomals is placed in the app root called configureation.php. Now if there is a backup it might be called configuration.php.bak.
   Joomla and other CMS store creds of the DB user in this config file.
   
   HTTP Verb and file upload
   
   Allowing the PUT verb. PUT does not mean we are actually able to upload, we will only be able to on writable directories.
    The permissions tied to this are that of the user running the web server.
 
    IIS allows for different users with different privs to be assigned to different levels of access in the web app (i.e a user for unauth vs auth)
 
    Hints as to where these writable dir may be can be hinted to where user avatars or other elements are located. 
    Create a list of candidates and fire off a test page for each. if successful the status will be 201.
    
           PUT <dir>  HTTP/1.1
           Content-length: 184
           <RETURN>

           [CONTENT OF TEST.HTML]
           <RETURN>
           <RETURN>

     
# Using google

Looking for open directory listings.

"Index of" bak  site:<target>.com
"Directory listing for" bak  site:<target>.com
firetype:"<inc, bak>"  site:<target>.com

http://www.googleguide.com/advanced_operators.html
 
https://www.exploit-db.com/google-hacking-database/

# using shodan


 
