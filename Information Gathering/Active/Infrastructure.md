**Information to collect:**

- Doamins
- Netblocks or IP addresses
- Mail servers
- ISP's used
- Any other technical information

- Keep in mind that discovered info may be out of scope seen is the SoE (Scope of Engagement).

The following will outline how to collect info in a similar situation as a real malicious actor. Starting with just the ORG name and the ORG website.

## Domains

**whois**

- https://who.is/whois/

CLI: 

     whois <domain>
     
      Whois will try to guess the right whois server to contact, if that fails it will as whoissolutions.com or whois.arin.net for the IP address and hostname. 
      May tell you the registers whois server. You can query that server specifically with -h
     
       - h force a whois server
       
     

 Public database. 
 
Search for target with no domain. then continue with other variations of TLDs and other in scope domains found.
 
 Information:
 
 - Owner of domain name
 - IP address (NETs) or range
 - Autonomous Systems Numbers (ASNs)
 - Technical contacts
 - Expiration data of the domain
 - Number of Resource Records
 - Organization records (ORGs)
 - Point of Contact records (POCs)
 - Authoritatice information for ASNs and registered outside of the RIR being queried.
 - DNS servers (remember that some may not be inscope)
 - Physical location (may be owned by the RIR and not target)
 
 - Note: WHOIS typically runs on port 43.
 - Note: RIR is not responsible for hte info in the database they maintain. That is up to the individual ORGs. 

*RIR (Regional Internet Registry)*

ORG that manages resources such as IP addresses and Autonomous Systems for a specific region. 
There are five main RIR providers for WHOIS info:

- AFRINIC
- ARIN
- LACNIC
- RIPE NCC

<img width="801" alt="Capture" src="https://user-images.githubusercontent.com/46513413/83462315-e5dfe180-a438-11ea-9a7b-a78c6fe7236c.PNG">


## DNS

Domain Name System (DNS) is a distributed database arranged hierarchically. Purpose to provide an IP for hostnames. 
Many protocols such as SSL are as safe as the DNS protocol they bind to. 




**Identify live hosts**

ICMP ping sweep: 

     fping -a -g IP/CIDR -r 0
     
      -a few ICMP echo request
        -A same but only those that are alive        
      -r  number of retries      
      -e returns response in MS
      -g subnets
      -q quiet, only see alive hosts

     nmap -sn IP/CIDR
     
      -sn - ping scan, then TCP SYN to port 443 and 80, then ICMP time stamp request. 
       note that unpriv users can only send SYN packets to port 443 and 80.
       note, if you run nmap scan from within the same network, it will actually run an ARP scan instead of ICMP packets.
        --disable-arp-ping or --send-ip to disable.
        
      -PS<port>  TCP SYN to specific port
      -PA  TCP ack
      -PU  UDP packet
      -PY  SCTPINIT packet dest port 80
      -PE  ICMP echo request
      -PM  ICMP mask request
      -PP  

     hping3 -1 <IP> -c 3
     
      -c number of requests
      -1 ICMP
      -2 UDP
      -S SNY packet
      -F send FIN packet
      -U send the URG flag
      -X xms (flags FIN, URG, PSH)
      
      subnets: 10.10.10.x --rand-dest (to repalce the x)
      
      -I eth0 

ICMP is to 100% reliable as it is common to disable it.



  



## Maltego

source intelligence and forensics app. 

Uses what it calls transforms to discover info about targets. you can start with a server address and enumerate various info about that server then build on that info until you have a full map of the entities entire internet presence.

Machines: maltego programs / scripts that allow us to extract info from internet 

Transforms:  programs / scripts queries that we can enumerate and gather info about a specific object 

Note that some machines are noisier than others. 

**Starting from blank machine (i.e click new at the top left)**

Palelt of the right -> choose where to start investigation. 

drag the object to the black space -> double click it to change the details 

right clicking it will show the transforms 






