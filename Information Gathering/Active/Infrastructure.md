**Information to collect:**

- Doamins
- Netblocks or IP addresses
- Mail servers
- ISP's used
- Any other technical information

- Keep in mind that discovered info may be out of scope seen is the SoE (Scope of Engagement).

The following will outline how to collect info in a similar situation as a real malicious actor. Starting with just the ORG name and the ORG website.

## Domains

**whois**

- https://who.is/whois/

CLI: 

     whois <domain>
     
      Whois will try to guess the right whois server to contact, if that fails it will as whoissolutions.com or whois.arin.net for the IP address and hostname. 
      May tell you the registers whois server. You can query that server specifically with -h
     
       - h force a whois server
       
     

 Public database. 
 
Search for target with no domain. then continue with other variations of TLDs and other in scope domains found.
 
 Information:
 
 - Owner of domain name
 - IP address (NETs) or range
 - Autonomous Systems Numbers (ASNs)
 - Technical contacts
 - Expiration data of the domain
 - Number of Resource Records
 - Organization records (ORGs)
 - Point of Contact records (POCs)
 - Authoritatice information for ASNs and registered outside of the RIR being queried.
 - DNS servers (remember that some may not be inscope)
 - Physical location (may be owned by the RIR and not target)
 
 - Note: WHOIS typically runs on port 43.
 - Note: RIR is not responsible for hte info in the database they maintain. That is up to the individual ORGs. 

*RIR (Regional Internet Registry)*

ORG that manages resources such as IP addresses and Autonomous Systems for a specific region. 
There are five main RIR providers for WHOIS info:

- AFRINIC
- ARIN
- LACNIC
- RIPE NCC

<img width="801" alt="Capture" src="https://user-images.githubusercontent.com/46513413/83462315-e5dfe180-a438-11ea-9a7b-a78c6fe7236c.PNG">


## DNS

Domain Name System (DNS) is a distributed database arranged hierarchically. Purpose to provide an IP for hostnames. 
Many protocols such as SSL are as safe as the DNS protocol they bind to. 

DNSSEC (DNS Security Extension) Add security to thwart attacks such as cach poisoning. Adds records to defeat other attacks and vulns.
DNSSRV (DNS Service): adds flexability to DNS

DNS servers contain textual records, each one given type, each with a different role.

DNS queries produce listings called Resource Records.

<img width="752" alt="Capture" src="https://user-images.githubusercontent.com/46513413/83463852-35281100-a43d-11ea-8de0-157cf3e7aed2.PNG">

- Resource Record: Starts with a domain name (usually FQDN). Anything other than FQDN, the name of the zone the record is in will auto be appended to the end of the name.

- TTL: recorded in seconds, defaults to the minimum value stated in the SOA record

- Record Class: Internet, Hesiod, OR Chaos

- Start of Authority(SOA): Indicates the beginning of a zone and it should occur first in a zone file. Only be one SOA record per zone.
  Defines certain values for the zone such as serial number and various expiration timeouts. 

 -Name Server(NS): Defines authoritative NS for a zone. Defines and delegates authority to a NS for a child zone. NS Records are the GLUE that binds the distributed database together. 

- Address(A): A record simnply maps a hostname to an IP address. Zones with A records are called forward zones 

- Pointer(PTR): PTR record maps an IP to a Hostname. Zones with PTR records are called reverse zones.

- CNAME: The CNAME record maps an alias hostname to an A record hostname

- Mail Exchange(MX): MX record specifies a host that will accept email on behalf of a given host. The host has a priority value. A single host may have multiple MX records. The records for a specific host make up a prioritized list.


**DNS lookups **

http://network-tools.com/nslook/

- DNS lookup: 

      nslookup <domain>
      
      dig <domain>

- reverse DNS lookup:  

      nslookup -type=PTR <IP>
       
      dig <domain> PTR
      
    Only domains with a PTR record set will respond to the above revese lookup

- MX lookup:  

      nslookup -type=MX <domain>
     
      dig <domain> MX
     
      http://www.mxtoolbox.com/

- zone transfer

  Usually a misconfig of the remote DNS server. Enabled only for trusted IP addresses (usually downstream NS)
  If enabled we can enumerate the entire DNS record for that zone.
     
   Windows: 
               
      nslookup -type=NS <domain>
      nslookup
      > server <domain>
      > ls -d <domain>
        
  Linux: 
  
      dig <domain> NS
      dig axfr @<DNS server/domain> <domain>
  
  
**Tools:**
  
  
fierce:

 1. Requests our DNS for the DNS servers of the target domain
 
 2. Uses the DNS servers of target domain 
 
 3.  Attempts to retrive a zone file transfer from the DNS servers
   If this fails, it attempts to brute force common sub domains.

        fierce -dns <domain>
  
         -dns <domains DNS to scan>
         
         -dnsserver <targets DNS server>
        
  
dnsenum 
  
    dnsenum <domain>
    
    -dnsserver <target name server>
    -f  <bruteforce list>
  
     Performs 4 actions:
     
     1. A records
     
     2. NS DNS records to find name servers
     
     3. MX records
      
     4. Tries to perform zone transfer 


dnsmap: 

 DNS sub domain brute force. Uses preloaded wordlist. 

     dnsmap <domain>

dnsrecon: 

   Checks bind versions, DNSSEC records, DNSSRV records, 

   dnsrecon -d <domain>


## IP 

Resolve all hostnames found.

Questions to ask: 

 - Is IP hosting only that given domain? 
 - Who does this IP address belong to? 
    - subdomains and those sites may be using DNS for the same server.

Reverse lookup: 

    dig -x <IP>
    nslookup -query=PTR <IP>
    
    bing search:  ip:<ip>
     will return all sites hosted by that IP

   http://www.tcpiputils.com/domain-neighbors
   http://reverseip.domaintools.com/
   https://www.robtex.com/

Note: an ASN is made up of one or more net blocks under same admin control. Big corps and ISPs have an ASN while smaller companies will bnarely have a net block.

Feeding the discovered IP into whois.arin.net will reveal the block and who owns it. 




















